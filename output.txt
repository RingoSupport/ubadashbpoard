mysql> describe smpp_sms_message_log;
+----------------------------+------------------+------+-----+---------+----------------+
| Field                      | Type             | Null | Key | Default | Extra          |
+----------------------------+------------------+------+-----+---------+----------------+
| pk_ssml_logid              | bigint unsigned  | NO   | PRI | NULL    | auto_increment |
| pk_ssml_log_time           | datetime         | NO   | PRI | NULL    |                |
| ssml_message_id            | varchar(65)      | NO   | MUL | NULL    |                |
| ssml_smpp_message_id       | varchar(65)      | NO   | MUL | NULL    |                |
| ssml_sp_access_account     | varchar(64)      | YES  | MUL | NULL    |                |
| ssml_pkg_id                | varchar(64)      | YES  | MUL | NULL    |                |
| ssml_temp_id               | varchar(20)      | YES  |     | NULL    |                |
| ssml_source                | tinyint unsigned | NO   |     | NULL    |                |
| ssml_direction             | tinyint unsigned | NO   |     | NULL    |                |
| ssml_subscriber_number     | varchar(20)      | NO   | MUL | NULL    |                |
| ssml_network_id            | int unsigned     | NO   |     | NULL    |                |
| ssml_calling_number        | varchar(20)      | NO   |     | NULL    |                |
| ssml_called_number         | varchar(20)      | NO   | MUL | NULL    |                |
| ssml_calling_change_number | varchar(20)      | YES  |     | NULL    |                |
| ssml_called_change_number  | varchar(20)      | YES  |     | NULL    |                |
| ssml_result                | int              | NO   |     | NULL    |                |
| ssml_sys_reason            | int              | NO   |     | NULL    |                |
| ssml_smpp_reason           | int              | NO   |     | NULL    |                |
| ssml_smpp_rsp_time         | int unsigned     | NO   |     | 0       |                |
| ssml_smpp_data_coding      | int unsigned     | NO   |     | NULL    |                |
| ssml_smpp_fragments        | int unsigned     | NO   |     | NULL    |                |
| ssml_maskkey               | char(8)          | NO   |     | NULL    |                |
| ssml_content               | varchar(8192)    | NO   |     | NULL    |                |
| ssml_opr_access_account    | varchar(64)      | YES  |     | NULL    |                |
| ssml_smpp_deliver_period   | int unsigned     | YES  |     | NULL    |                |
| ssml_correlate_id          | varchar(64)      | YES  |     | NULL    |                |
+----------------------------+------------------+------+-----+---------+----------------+
26 rows in set (0.01 sec)

mysql> select * from smpp_sms_message_log where  ssml_direction = '2' order by pk_ssml_log_time desc limit 1;
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
| pk_ssml_logid | pk_ssml_log_time    | ssml_message_id                          | ssml_smpp_message_id | ssml_sp_access_account | ssml_pkg_id | ssml_temp_id | ssml_source | ssml_direction | ssml_subscriber_number | ssml_network_id | ssml_calling_number | ssml_called_number | ssml_calling_change_number | ssml_called_change_number | ssml_result | ssml_sys_reason | ssml_smpp_reason | ssml_smpp_rsp_time | ssml_smpp_data_coding | ssml_smpp_fragments | ssml_maskkey | ssml_content                                                                                                                     | ssml_opr_access_account | ssml_smpp_deliver_period | ssml_correlate_id                        |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
|   15981478466 | 2025-09-29 10:14:00 | 4d4989d34c874c6ea8e9c402890a1a2bd1a19c37 | e0f81581             | ubasms51               |             |              |           0 |              2 | 7066273342             |               1 | 7066273342          | UBA                |                            |                           |           3 |               0 |                0 |                  0 |                     0 |                   1 | FFA4BB5B     | lsCBaMiTj2jKkINqyITILp2ei2vOhN83idbfYc+Ui3uM0dk2ltCbP57Q3mHNkYtizZOKa86Xmz+Qyt57m8XPPsWWjmvGloJqz5WPe4zQ2i/F4eMLtvb+H9/BySnFlo5u | RING509946Bank          |                   172802 | b32de26b9b184fed8bef97b0de8a2ca0c4cc84e3 |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
1 row in set (0.07 sec)

mysql> select * from smpp_sms_message_log where ssml_subscriber_number = '9159403602' order by pk_ssml_log_time desc limit 3;
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
| pk_ssml_logid | pk_ssml_log_time    | ssml_message_id                          | ssml_smpp_message_id | ssml_sp_access_account | ssml_pkg_id | ssml_temp_id | ssml_source | ssml_direction | ssml_subscriber_number | ssml_network_id | ssml_calling_number | ssml_called_number | ssml_calling_change_number | ssml_called_change_number | ssml_result | ssml_sys_reason | ssml_smpp_reason | ssml_smpp_rsp_time | ssml_smpp_data_coding | ssml_smpp_fragments | ssml_maskkey | ssml_content                                                                                                                                                                                         | ssml_opr_access_account | ssml_smpp_deliver_period | ssml_correlate_id                        |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
|   15957479938 | 2025-09-28 11:36:28 | 48062d95637541abbde838e5de9ce8269e6f49cc | 1187294428           | ubasms                 |             |              |           1 |              1 | 9159403602             |               3 | UBA                 | 9159403602         |                            |                           |           0 |               0 |                0 |                  0 |                     1 |                   1 | FAA2AC23     | 8OHeRp7L2AO7zslRjpiMB8Kbmw/JkpwNypKMZajt4QOq7eBiqOv/DNrs7WS1++0D2uP5d7WC6W2u5/5zqOv/ZqmP7gPMl4YJ0IiGCcOajEyUgp4R1ZKVDMiSnhba4owSyZiZG8CRmwO4w8AZ2oadD8iSng/Ik58NyZKMDteCxVfd0YxC2tbJUI6CwUaJ0c1En4ym | ringofin                |                        0 |                                          |
|   15953840048 | 2025-09-28 09:09:01 | 5cca0eb2c2c14138817bef616f9f1c7c9e21d6ec | 0888640084           | ubasms                 |             |              |           1 |              1 | 9159403602             |               3 | UBA                 | 9159403602         |                            |                           |           0 |               0 |                0 |                  0 |                     0 |                   1 | AE499760     | pArlBcog40DvJfIS2nO3RJZwoEydeadOnnm3JvwG2kD+Btsh/ADET44H1ifhENZAjgjCNOFp0i76DMUw/ADEJf1k1UCYfL1KhGO9Spdxtw/AaaVSgXmuT5x5pVWOCbdRnXOiWJR6oEDsKPtajm2mTJx5pUyceKROnXm3TYNp/hSJOrcBjj3yE9pp+gXdOvYHy2ed | ringofin                |                        0 |                                          |
|   15908036500 | 2025-09-26 20:40:52 | 2f8ca76617964da997e8548a2852ec13599c80e7 | 0920248011           | sterling1              |             |              |           0 |              2 | 9159403602             |               3 | 9159403602          | STERLING           |                            |                           |           2 |               0 |                0 |                  0 |                     0 |                   1 | AFAD7401     | xslOMZafRDOblUQwno0HdM2XRDGfjRBt2d8QO5+dRCHc2BZsxtlUZc7ZETudmEQ4nZtGMZudQTGPyRtvyo0QYNvITjOanU0zmZ9ENZ+YRCHc2RV1lekxTeb7JkWPyAZzlZ1EMY/5EXnblzBkzcQAIe7BEXPbjHkL7s4XdZWN                             | ringofin                |                        2 | ed9eca5ea77949339d9462fd108d6334cf5c0c29 |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
3 rows in set (0.30 sec)

mysql> select * from smpp_sms_message_log where ssml_subscriber_number = '9159403602' order by pk_ssml_log_time desc limit 5;
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
| pk_ssml_logid | pk_ssml_log_time    | ssml_message_id                          | ssml_smpp_message_id | ssml_sp_access_account | ssml_pkg_id | ssml_temp_id | ssml_source | ssml_direction | ssml_subscriber_number | ssml_network_id | ssml_calling_number | ssml_called_number | ssml_calling_change_number | ssml_called_change_number | ssml_result | ssml_sys_reason | ssml_smpp_reason | ssml_smpp_rsp_time | ssml_smpp_data_coding | ssml_smpp_fragments | ssml_maskkey | ssml_content                                                                                                                                                                                         | ssml_opr_access_account | ssml_smpp_deliver_period | ssml_correlate_id                        |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
|   15957479938 | 2025-09-28 11:36:28 | 48062d95637541abbde838e5de9ce8269e6f49cc | 1187294428           | ubasms                 |             |              |           1 |              1 | 9159403602             |               3 | UBA                 | 9159403602         |                            |                           |           0 |               0 |                0 |                  0 |                     1 |                   1 | FAA2AC23     | 8OHeRp7L2AO7zslRjpiMB8Kbmw/JkpwNypKMZajt4QOq7eBiqOv/DNrs7WS1++0D2uP5d7WC6W2u5/5zqOv/ZqmP7gPMl4YJ0IiGCcOajEyUgp4R1ZKVDMiSnhba4owSyZiZG8CRmwO4w8AZ2oadD8iSng/Ik58NyZKMDteCxVfd0YxC2tbJUI6CwUaJ0c1En4ym | ringofin                |                        0 |                                          |
|   15953840048 | 2025-09-28 09:09:01 | 5cca0eb2c2c14138817bef616f9f1c7c9e21d6ec | 0888640084           | ubasms                 |             |              |           1 |              1 | 9159403602             |               3 | UBA                 | 9159403602         |                            |                           |           0 |               0 |                0 |                  0 |                     0 |                   1 | AE499760     | pArlBcog40DvJfIS2nO3RJZwoEydeadOnnm3JvwG2kD+Btsh/ADET44H1ifhENZAjgjCNOFp0i76DMUw/ADEJf1k1UCYfL1KhGO9Spdxtw/AaaVSgXmuT5x5pVWOCbdRnXOiWJR6oEDsKPtajm2mTJx5pUyceKROnXm3TYNp/hSJOrcBjj3yE9pp+gXdOvYHy2ed | ringofin                |                        0 |                                          |
|   15908036500 | 2025-09-26 20:40:52 | 2f8ca76617964da997e8548a2852ec13599c80e7 | 0920248011           | sterling1              |             |              |           0 |              2 | 9159403602             |               3 | 9159403602          | STERLING           |                            |                           |           2 |               0 |                0 |                  0 |                     0 |                   1 | AFAD7401     | xslOMZafRDOblUQwno0HdM2XRDGfjRBt2d8QO5+dRCHc2BZsxtlUZc7ZETudmEQ4nZtGMZudQTGPyRtvyo0QYNvITjOanU0zmZ9ENZ+YRCHc2RV1lekxTeb7JkWPyAZzlZ1EMY/5EXnblzBkzcQAIe7BEXPbjHkL7s4XdZWN                             | ringofin                |                        2 | ed9eca5ea77949339d9462fd108d6334cf5c0c29 |
|   15908026540 | 2025-09-26 20:40:50 | ed9eca5ea77949339d9462fd108d6334cf5c0c29 | 0920248011           | sterling1              |             |              |           1 |              1 | 9159403602             |               3 | STERLING            | 9159403602         |                            |                           |           0 |               0 |                0 |                  0 |                     0 |                   1 | B398AF48     | 9/3NIce47iTW6ttpvpLuK9DslWiQu5Z+i6yiQvf93CuJuO4q1+3DKcnx1Wi+ku4lx6KPBvTWj3GfqJ94n6ifeL6Sn32cqJtngaidffOon3KBqJV9g5WlCcX5xiSd2s4kibjhD/24nnmfqJ14n6ufep2qnEW50cEu3KePeIGonn+DqJ99hq0=                 | ringofin                |                        0 |                                          |
|   15901489955 | 2025-09-26 18:50:07 | d0bac35f7d2343d8a96db85cefb5e4dbd49d01a5 | 1151077032           | sterling1              |             |              |           0 |              2 | 9159403602             |               3 | 9159403602          | STERLING           |                            |                           |           2 |               0 |                0 |                  0 |                     0 |                   1 | EBE5597A     | goFjS9rQaErc0mlJ2cUqD4nfaUrbxT0WnZc9QNvVaVqYkDsXgpF5HoqRPEDZ0GlD2dNoQt7VaUrLgTYUjsU9G5+AY0je1WBI3dRhT9vVaVqYkTgO0aEcNqKzCz7LgCsI0dVpSsuxPAKf3x0fiYwtWqqJPAifxFRwqoY6DtHF                             | ringofin                |                        7 | b5d9a0a7a95c48e083a2100b35a99892a31221b2 |
+---------------+---------------------+------------------------------------------+----------------------+------------------------+-------------+--------------+-------------+----------------+------------------------+-----------------+---------------------+--------------------+----------------------------+---------------------------+-------------+-----------------+------------------+--------------------+-----------------------+---------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+--------------------------+------------------------------------------+
5 rows in set (0.02 sec)



MariaDB [uba]> describe messages;
+-------------+---------------+------+-----+---------+-------+
| Field       | Type          | Null | Key | Default | Extra |
+-------------+---------------+------+-----+---------+-------+
| id          | varchar(20)   | NO   | PRI | NULL    |       |
| msisdn      | text          | YES  | MUL | NULL    |       |
| pages       | int(11)       | NO   | MUL | 1       |       |
| text        | text          | YES  |     | NULL    |       |
| response    | text          | YES  | MUL | NULL    |       |
| dlr_status  | varchar(20)   | YES  | MUL | 0       |       |
| dlr_report  | int(1)        | NO   | MUL | 0       |       |
| created_at  | timestamp     | YES  | MUL | NULL    |       |
| updated_at  | timestamp     | YES  |     | NULL    |       |
| dlr         | enum('1','0') | YES  |     | NULL    |       |
| status      | enum('1','0') | YES  |     | 0       |       |
| senderid    | varchar(50)   | YES  |     | NULL    |       |
| counter     | enum('0','1') | YES  |     | 0       |       |
| dlr_request | text          | YES  |     | NULL    |       |
| dlr_results | text          | YES  |     | NULL    |       |
| network     | varchar(10)   | YES  |     | NULL    |       |
+-------------+---------------+------+-----+---------+-------+



function decode_ssml_content($maskKey, $contentBase64) { $decoded = base64_decode($contentBase64, true); if ($decoded === false) return false; $maskBytes = []; for ($i = 0; $i < 4; $i++) { $maskBytes[$i] = hexdec(substr($maskKey, $i * 2, 2)); } $result = ''; $len = strlen($decoded); for ($i = 0; $i < $len; $i++) { $result .= $decoded[$i] ^ chr($maskBytes[$i % 4]); } return $result; } function extractStatAndErr($decodedStr) { $stat = $err = null; if (preg_match('/stat:([A-Z]+)\s+err:(\d+)/', $decodedStr, $matches)) { $stat = $matches[1]; $err = $matches[2]; } return ['stat' => $stat, 'err' => $err]; }